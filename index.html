<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Cronos v1.342 - Est√°vel</title>
    <style>
        /* --- ESTILOS GERAIS --- */
        :root { --accent: #00d2ff; --bg: #121212; --panel: #1e1e1e; --text: #e0e0e0; }
        body { font-family: 'Segoe UI', Roboto, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; height: 100vh; overflow: hidden; cursor: default; }
        
        /* --- CONFIGURA√á√ÉO --- */
        #config-screen { padding: 20px; height: 100vh; overflow-y: auto; box-sizing: border-box; max-width: 1200px; margin: 0 auto; }
        .painel-top { background: var(--panel); padding: 15px; border-radius: 8px; border-left: 5px solid var(--accent); margin-bottom: 20px; display: flex; gap: 20px; flex-wrap: wrap; align-items: flex-end; }
        .campo { display: flex; flex-direction: column; }
        .campo label { font-size: 0.8rem; color: #bbb; margin-bottom: 5px; }
        
        input, select { background: #333; color: white; border: 1px solid #555; padding: 8px; border-radius: 4px; }
        input:disabled { background: #222; color: #555; border-color: #333; cursor: not-allowed; }

        .time-group { display: flex; align-items: center; gap: 5px; }
        .btn-small { background: #444; border: 1px solid #666; color: #fff; width: 30px; height: 35px; border-radius: 4px; cursor: pointer; font-size: 1rem; display: flex; align-items: center; justify-content: center; padding: 0; transition: 0.2s; }
        .btn-small:hover:not(:disabled) { background: var(--accent); color: #000; border-color: var(--accent); }
        
        #global-titulo { background: transparent; border: none; font-size: 1.8rem; font-weight: bold; color: var(--accent); width: 100%; padding: 5px; margin: 0; }

        .btn-file { background: #444; border: 1px solid #666; color: #fff; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-size: 0.9rem; display: flex; align-items: center; gap: 5px; text-decoration: none; }
        .btn-file:hover { background: #555; }
        .btn-folder { background: #28a745; border-color: #28a745; font-weight: bold; }

        .chk-label { display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 0.9rem; }
        .chk-input { width: 18px; height: 18px; cursor: pointer; }

        input[type="color"] { cursor: pointer; width: 50px; height: 40px; padding: 0; border-radius: 4px; background: none; border: 1px solid #555; }
        
        .fase-wrapper { margin-bottom: 10px; border: 1px solid #444; border-radius: 6px; background: #252526; overflow: hidden; }
        .fase-row { padding: 10px; display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
        
        .audio-panel { background: #151515; padding: 10px; border-top: 1px dashed #444; display: none; }
        .audio-panel.open { display: block; }
        .audio-slot { display: flex; gap: 10px; align-items: flex-end; margin-bottom: 8px; background: #222; padding: 8px; border-radius: 4px; border-left: 3px solid var(--accent); flex-wrap: wrap; }
        
        .status-ok { color: #28a745; font-size: 0.75rem; border-left: 3px solid #28a745; padding-left: 5px; }
        .status-missing { color: #ff4444; font-size: 0.75rem; border-left: 3px solid #ff4444; padding-left: 5px; }

        .hidden { display: none !important; }
        .btn-x { background: #ff4444; color: white; border: none; width: 25px; height: 25px; border-radius: 50%; font-weight: bold; cursor: pointer; }
        .btn-add { background: #444; color: white; border: 1px solid #666; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
        .btn-go { background: linear-gradient(135deg, #00d2ff, #0072ff); color: white; border: none; padding: 15px; flex-grow: 1; font-weight: bold; font-size: 1.1rem; border-radius: 4px; cursor: pointer; }

        /* --- APRESENTA√á√ÉO --- */
        #display-screen { display: none; height: 100vh; width: 100vw; flex-direction: column; align-items: center; justify-content: center; background-color: #000; background-size: cover; background-position: center; position: relative; }
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1; }
        
        #relogio-real { position: absolute; top: 15px; right: 20px; z-index: 20; font-size: 1.5rem; background: rgba(0,0,0,0.5); padding: 5px 15px; border-radius: 20px; border: 1px solid #444; }
        #btn-sair { position: absolute; top: 15px; left: 20px; z-index: 20; background: none; border: none; color: #555; font-size: 1.2rem; cursor: pointer; }

        .conteudo-box { z-index: 10; text-align: center; padding: 40px; border-radius: 20px; background: rgba(20, 20, 20, 0.8); backdrop-filter: blur(5px); min-width: 60%; max-width: 90%; box-shadow: 0 10px 30px rgba(0,0,0,0.5); position: relative; }
        #timer-principal { font-size: 9rem; margin: 0; font-weight: bold; line-height: 1; font-variant-numeric: tabular-nums; }
        .timer-waiting { color: #777 !important; font-size: 5rem !important; }

        /* Anima√ß√µes */
        .piscando-cor { animation: pulse-opacity 1s infinite; }
        @keyframes pulse-opacity { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .piscando-vermelho { color: #ff4444 !important; animation: pulse-red 1s infinite; }
        @keyframes pulse-red { 50% { text-shadow: 0 0 20px red; } }
        .bg-panic { background-color: #300000 !important; animation: bg-flash 1s infinite; }
        @keyframes bg-flash { 50% { background-color: #600000 !important; } }

        /* MODAIS */
        .modal-base { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 100; align-items: center; justify-content: center; }
        .modal-box { background: #222; padding: 30px; border-radius: 10px; border: 1px solid #444; max-width: 500px; text-align: center; }
        .modal-opts { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
        .btn-modal { padding: 12px; border: none; background: #333; color: white; cursor: pointer; border-radius: 4px; text-align: left; }
        .btn-modal:hover { background: #444; }
    </style>
</head>
<body>

    <input type="file" id="file-input" style="display: none;" accept=".json" onchange="carregarArquivo(this)">
    <input type="file" id="folder-input" style="display: none;" webkitdirectory directory onchange="processarPastaTrabalho(this)">

    <div id="config-screen">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid #333; padding-bottom:15px;">
            <div style="display:flex; align-items:center; gap:10px; flex-grow:1;">
                <input type="text" id="global-titulo" value="Escola Sabatina Viva">
                <input type="color" id="global-cor-titulo" value="#00d2ff">
                <label class="chk-label"><input type="checkbox" id="chk-exibir-titulo" checked> Exibir</label>
            </div>
            <div style="display:flex; gap:10px;">
                <button class="btn-file btn-folder" onclick="document.getElementById('folder-input').click()">üìÇ Pasta M√≠dia</button>
                <button class="btn-file" onclick="salvarConfiguracao()">üíæ Salvar</button>
                <button class="btn-file" onclick="document.getElementById('file-input').click()">üìÇ Abrir</button>
            </div>
        </div>
        
        <div class="painel-top">
            <div class="campo">
                <label>In√≠cio Planejado</label>
                <div class="time-group" id="group-inicio">
                    <input type="time" id="hora-inicio">
                    <button class="btn-small" onclick="calcSetInicioAgora()">‚è±Ô∏è</button>
                    <button class="btn-small" onclick="calcInicioPeloFim()">‚è™</button>
                </div>
            </div>
            
            <div class="campo">
                <label>Fim Absoluto</label>
                <div class="time-group" id="group-fim">
                    <input type="time" id="hora-fim">
                    <button class="btn-small" onclick="calcFimPeloInicio()">‚è©</button>
                </div>
            </div>
            
            <div class="campo" style="flex-direction: row; align-items: center; gap: 20px;">
                <label class="chk-label"><input type="checkbox" id="chk-intervalos" onchange="toggleIntervalosGlobais()"> Intervalos</label>
                <label class="chk-label"><input type="checkbox" id="chk-audio-global" checked onchange="toggleAudioGlobal()"> Permitir √Åudio</label>
                <label class="chk-label"><input type="checkbox" id="chk-estouro-global" checked> Permitir Estouro</label>
            </div>
        </div>

        <div id="lista-fases"></div>

        <div style="display:flex; gap:15px; margin-top:20px; padding-bottom:50px;">
            <button class="btn-add" onclick="adicionarFase()">+ Nova Etapa</button>
            <button class="btn-go" onclick="iniciarApresentacao()">INICIAR APRESENTA√á√ÉO ‚ñ∑</button>
        </div>
    </div>

    <div id="display-screen">
        <button id="btn-sair" onclick="encerrar()">‚úï</button>
        <div class="overlay"></div>
        <div id="relogio-real">--:--</div>

        <div class="conteudo-box" id="box-principal">
            <h1 id="display-global-titulo" class="hidden"></h1>
            <h2 id="titulo-fase">...</h2>
            <div id="timer-principal">00:00</div>
            
            <button id="btn-intervalo-manual" class="btn-add hidden" style="background:#ffaa00; color:#000; font-weight:bold; padding:20px; border-radius:50px; margin-top:20px;" onclick="sairIntervaloManual()">INICIAR PR√ìXIMA PARTE ‚ñ∂</button>

            <div style="margin-top: 20px; display: flex; justify-content: center; gap: 10px;">
                <button id="btn-pausar" class="btn-add" style="font-size: 0.8rem;" onclick="acaoPausar()">‚è∏ PAUSAR</button>
                <button id="btn-continuar" class="btn-add hidden" style="font-size: 0.8rem;" onclick="acaoContinuar()">‚ñ∂ CONTINUAR</button>
                <button class="btn-add" style="font-size: 0.8rem;" onclick="acaoAdicionarTempo()">+1 Min</button>
                <button class="btn-add" style="font-size: 0.8rem;" onclick="acaoAvan√ßar()">‚è≠ PULAR</button>
            </div>
        </div>
    </div>

    <div id="modal-decisao" class="modal-base">
        <div class="modal-box" style="border-color:#ff4444;">
            <h2 style="color:#ff4444; margin-top:0;">‚ö†Ô∏è Tempo Esgotado</h2>
            <p>O tempo planejado excede o hor√°rio final. O que deseja fazer?</p>
            <div class="modal-opts">
                <button class="btn-modal" onclick="resolverConflito(1)"><b>1. Reduzir Todas</b> (Proporcional)</button>
                <button class="btn-modal" onclick="resolverConflito(3)"><b>2. Ignorar Prazo</b> (Continuar Livre)</button>
                <button class="btn-modal" onclick="document.getElementById('modal-decisao').style.display='none'"><b>3. Cancelar</b></button>
            </div>
        </div>
    </div>

    <script>
        /* --- 1. VARI√ÅVEIS E ESTADO --- */
        let mediaCache = {}; 
        let cronograma = []; 
        let indexAtual = 0; 
        let tempoRestante = 0; 
        let estado = "PARADO"; // PARADO, RODANDO, PAUSADO, INTERVALO, WAITING
        let intervaloTimer = null; 
        let dataFimGlobal = null; 
        let activeAudio = null;
        let emIntervalo = false;

        /* --- 2. AUXILIARES --- */
        const formatTime = (d) => `${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
        
        function montarData(s, ref) {
            const [h, m] = s.split(':');
            const d = new Date(ref);
            d.setHours(parseInt(h), parseInt(m), 0, 0);
            return d;
        }

        function limparObjetosMemoria() {
            cronograma.forEach(f => {
                if (f.img && f.img.startsWith('blob:')) URL.revokeObjectURL(f.img);
                if (f.customAudios) f.customAudios.forEach(a => URL.revokeObjectURL(a.src));
            });
        }

        /* --- 3. √ÅUDIO E BIPS --- */
        function tocarBip() {
            if (!document.getElementById('chk-audio-global').checked) return;
            try {
                const c = new (window.AudioContext || window.webkitAudioContext)();
                const o = c.createOscillator();
                o.type = 'sine'; o.frequency.value = 880;
                o.connect(c.destination);
                o.start(); o.stop(c.currentTime + 0.3);
            } catch(e) {}
        }

        function fadeAndStop(audioObj, duration = 2) {
            if (!audioObj || !audioObj.el) return;
            const audio = audioObj.el;
            const step = 0.05;
            const interval = setInterval(() => {
                if (audio.volume > step) audio.volume -= step;
                else {
                    audio.pause();
                    clearInterval(interval);
                    if (activeAudio === audioObj) activeAudio = null;
                }
            }, (duration * 1000) / (audio.volume / step));
        }

        function playSmartAudio(config) {
            if (!document.getElementById('chk-audio-global').checked) return;
            if (activeAudio) fadeAndStop(activeAudio, 1);
            
            const audio = new Audio(config.src);
            audio.loop = config.loop;
            audio.volume = 1.0;
            audio.customFlags = config;
            activeAudio = { el: audio, config: config };
            audio.play().catch(e => console.warn("Erro ao tocar √°udio:", e));
        }

        /* --- 4. GEST√ÉO DE FASES (DOM) --- */
        function adicionarFase(tit="", min=10, bg="#121212", txt="#ffffff") {
            const container = document.getElementById('lista-fases');
            const wrapper = document.createElement('div');
            wrapper.className = 'fase-wrapper';
            wrapper.innerHTML = `
                <div class="fase-row">
                    <button class="btn-x" onclick="this.closest('.fase-wrapper').remove()">X</button>
                    <div class="campo" style="flex:2"><label>T√≠tulo</label><input type="text" class="inp-titulo" value="${tit}"></div>
                    <div class="campo" style="width:60px"><label>Min</label><input type="number" class="inp-tempo" value="${min}"></div>
                    <div class="campo"><label>Redut?</label><input type="checkbox" class="inp-redutivel" checked></div>
                    <div class="campo col-intervalo hidden"><label>Pausa(s)</label><input type="number" class="inp-int-tempo" value="30"></div>
                    <div class="campo"><label>Cor Bg</label><input type="color" class="inp-bg" value="${bg}"></div>
                    <div class="campo"><label>Cor Txt</label><input type="color" class="inp-txt" value="${txt}"></div>
                    <div class="campo" style="flex:1"><label>Imagem</label><input type="file" class="inp-img" accept="image/*"></div>
                    <button class="btn-small" onclick="this.closest('.fase-wrapper').querySelector('.audio-panel').classList.toggle('open')">üéµ</button>
                </div>
                <div class="audio-panel">
                    <div class="audio-list"></div>
                    <button class="btn-add" style="padding:5px; font-size:0.7rem;" onclick="adicionarSlotAudio(this.parentElement)">+ Som</button>
                </div>
            `;
            container.appendChild(wrapper);
            toggleIntervalosGlobais();
            return wrapper;
        }

        function adicionarSlotAudio(panel, min=0, sec=0, fname="") {
            const list = panel.querySelector('.audio-list') || panel;
            const div = document.createElement('div');
            div.className = 'audio-slot';
            div.innerHTML = `
                <div class="campo"><label>Min:Seg</label><div class="time-group">
                    <input type="number" class="aud-min" value="${min}" style="width:40px">:<input type="number" class="aud-sec" value="${sec}" style="width:40px">
                </div></div>
                <div class="campo"><label>Arquivo</label><input type="file" class="aud-file" accept="audio/*"></div>
                <div class="campo"><label>Loop</label><input type="checkbox" class="aud-loop"></div>
                <button class="btn-x" style="width:20px; height:20px;" onclick="this.parentElement.remove()">-</button>
            `;
            list.appendChild(div);
        }

        /* --- 5. L√ìGICA DO CRON√îMETRO --- */
        function iniciarApresentacao() {
            limparObjetosMemoria();
            const hI = document.getElementById('hora-inicio').value;
            const hF = document.getElementById('hora-fim').value;
            if (!hI || !hF) return alert("Preencha hor√°rios de In√≠cio e Fim.");

            const now = new Date();
            dataFimGlobal = montarData(hF, now);
            if (dataFimGlobal < now) dataFimGlobal.setDate(dataFimGlobal.getDate() + 1);

            construirCronograma();
            
            const totalS = cronograma.reduce((a, b) => a + b.segundosFinais, 0);
            const dispS = (dataFimGlobal - now) / 1000;

            if (totalS > dispS + 10) {
                document.getElementById('modal-decisao').style.display = 'flex';
            } else {
                rodarSistema();
            }
        }

        function construirCronograma() {
            cronograma = [];
            document.querySelectorAll('.fase-wrapper').forEach(wrap => {
                const row = wrap.querySelector('.fase-row');
                const audios = [];
                wrap.querySelectorAll('.audio-slot').forEach(slot => {
                    const file = slot.querySelector('.aud-file').files[0];
                    if (file) {
                        audios.push({
                            trigger: (parseInt(slot.querySelector('.aud-min').value)*60) + parseInt(slot.querySelector('.aud-sec').value),
                            src: URL.createObjectURL(file),
                            loop: slot.querySelector('.aud-loop').checked
                        });
                    }
                });

                const imgFile = row.querySelector('.inp-img').files[0];
                cronograma.push({
                    titulo: row.querySelector('.inp-titulo').value,
                    segundosFinais: parseFloat(row.querySelector('.inp-tempo').value) * 60,
                    redutivel: row.querySelector('.inp-redutivel').checked,
                    intSegundos: parseInt(row.querySelector('.inp-int-tempo').value) || 0,
                    bg: row.querySelector('.inp-bg').value,
                    txt: row.querySelector('.inp-txt').value,
                    img: imgFile ? URL.createObjectURL(imgFile) : null,
                    customAudios: audios
                });
            });
        }

        function rodarSistema() {
            document.getElementById('config-screen').style.display = 'none';
            document.getElementById('display-screen').style.display = 'flex';
            
            if (document.getElementById('chk-exibir-titulo').checked) {
                const el = document.getElementById('display-global-titulo');
                el.innerText = document.getElementById('global-titulo').value;
                el.style.color = document.getElementById('global-cor-titulo').value;
                el.classList.remove('hidden');
            }
            
            indexAtual = 0;
            rodarFase(0);
        }

        function rodarFase(idx) {
            if (idx >= cronograma.length) return encerrar();
            indexAtual = idx;
            const fase = cronograma[idx];
            tempoRestante = fase.segundosFinais;
            emIntervalo = false;
            estado = "RODANDO";

            aplicarVisual(fase);
            if (intervaloTimer) clearInterval(intervaloTimer);
            intervaloTimer = setInterval(tick, 1000);
        }

        function gerenciarIntervalo() {
            const fase = cronograma[indexAtual];
            if (fase.intSegundos > 0 && indexAtual < cronograma.length - 1) {
                estado = "INTERVALO";
                emIntervalo = true;
                tempoRestante = fase.intSegundos;
                document.getElementById('titulo-fase').innerText = "INTERVALO";
                document.getElementById('timer-principal').style.color = "#ffaa00";
            } else {
                rodarFase(indexAtual + 1);
            }
        }

        function tick() {
            if (estado !== "RODANDO" && estado !== "INTERVALO") return;

            // Trigger de √Åudios Customizados
            if (estado === "RODANDO") {
                const fase = cronograma[indexAtual];
                fase.customAudios.forEach(aud => {
                    if (aud.trigger === Math.floor(tempoRestante)) playSmartAudio(aud);
                });
            }

            tempoRestante--;
            atualizarDisplayTimer();

            if (tempoRestante < 0) {
                if (document.getElementById('chk-estouro-global').checked || indexAtual === cronograma.length - 1) {
                    // Modo Estouro Negativo
                    tocarBip();
                } else {
                    clearInterval(intervaloTimer);
                    tocarBip();
                    if (emIntervalo) rodarFase(indexAtual + 1);
                    else gerenciarIntervalo();
                }
            }
        }

        function atualizarDisplayTimer() {
            const el = document.getElementById('timer-principal');
            const abs = Math.abs(tempoRestante);
            const m = Math.floor(abs / 60);
            const s = abs % 60;
            const sinal = tempoRestante < 0 ? "-" : "";
            el.innerText = `${sinal}${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;

            el.classList.remove('piscando-cor', 'piscando-vermelho');
            document.getElementById('display-screen').classList.remove('bg-panic');

            if (tempoRestante > 0 && tempoRestante <= 30) el.classList.add('piscando-cor');
            if (tempoRestante < 0) {
                el.classList.add('piscando-vermelho');
                if (tempoRestante < -30) document.getElementById('display-screen').classList.add('bg-panic');
            }
        }

        function aplicarVisual(f) {
            const ds = document.getElementById('display-screen');
            ds.style.backgroundColor = f.bg;
            ds.style.backgroundImage = f.img ? `url('${f.img}')` : 'none';
            document.getElementById('titulo-fase').innerText = f.titulo;
            document.getElementById('titulo-fase').style.color = f.txt;
            document.getElementById('timer-principal').style.color = f.txt;
        }

        /* --- 6. CONTROLES --- */
        function acaoPausar() {
            estado = "PAUSADO";
            clearInterval(intervaloTimer);
            document.getElementById('btn-pausar').classList.add('hidden');
            document.getElementById('btn-continuar').classList.remove('hidden');
        }

        function acaoContinuar() {
            estado = emIntervalo ? "INTERVALO" : "RODANDO";
            intervaloTimer = setInterval(tick, 1000);
            document.getElementById('btn-pausar').classList.remove('hidden');
            document.getElementById('btn-continuar').classList.add('hidden');
        }

        function acaoAvan√ßar() {
            rodarFase(indexAtual + 1);
        }

        function acaoAdicionarTempo() {
            tempoRestante += 60;
            atualizarDisplayTimer();
        }

        function encerrar() {
            clearInterval(intervaloTimer);
            if (activeAudio) fadeAndStop(activeAudio, 1);
            document.getElementById('display-screen').style.display = 'none';
            document.getElementById('config-screen').style.display = 'block';
            if (document.fullscreenElement) document.exitFullscreen();
        }

        function resolverConflito(opt) {
            document.getElementById('modal-decisao').style.display = 'none';
            if (opt === 3) { rodarSistema(); return; }
            
            // Redu√ß√£o Proporcional
            const totalS = cronograma.reduce((a, b) => a + b.segundosFinais, 0);
            const dispS = (dataFimGlobal - new Date()) / 1000;
            const fator = dispS / totalS;
            
            cronograma.forEach(f => {
                if (f.redutivel) f.segundosFinais = Math.floor(f.segundosFinais * fator);
            });
            rodarSistema();
        }

        /* --- 7. CONFIGURA√á√ïES UI --- */
        function toggleIntervalosGlobais() {
            const ativo = document.getElementById('chk-intervalos').checked;
            document.querySelectorAll('.col-intervalo').forEach(el => {
                ativo ? el.classList.remove('hidden') : el.classList.add('hidden');
            });
        }

        function toggleAudioGlobal() {
            if (!document.getElementById('chk-audio-global').checked && activeAudio) fadeAndStop(activeAudio, 1);
        }

        function calcSetInicioAgora() { document.getElementById('hora-inicio').value = formatTime(new Date()); }
        
        function calcFimPeloInicio() {
            const hI = document.getElementById('hora-inicio').value;
            if (!hI) return;
            let totalMin = 0;
            document.querySelectorAll('.inp-tempo').forEach(i => totalMin += parseFloat(i.value) || 0);
            const d = montarData(hI, new Date());
            d.setMinutes(d.getMinutes() + totalMin);
            document.getElementById('hora-fim').value = formatTime(d);
        }

        function calcInicioPeloFim() {
            const hF = document.getElementById('hora-fim').value;
            if (!hF) return;
            let totalMin = 0;
            document.querySelectorAll('.inp-tempo').forEach(i => totalMin += parseFloat(i.value) || 0);
            const d = montarData(hF, new Date());
            d.setMinutes(d.getMinutes() - totalMin);
            document.getElementById('hora-inicio').value = formatTime(d);
        }

        /* --- 8. ATALHOS DE TECLADO --- */
        window.addEventListener('keydown', (e) => {
            if (document.getElementById('display-screen').style.display === 'flex') {
                if (e.code === 'Space') { e.preventDefault(); estado === "RODANDO" ? acaoPausar() : acaoContinuar(); }
                if (e.code === 'KeyN') acaoAvan√ßar();
                if (e.code === 'Escape') encerrar();
            }
        });

        /* --- INICIALIZA√á√ÉO --- */
        window.onload = () => {
            calcSetInicioAgora();
            calcFimPeloInicio();
            adicionarFase("Confraterniza√ß√£o", 10, "#ffcc00", "#000000");
            adicionarFase("Miss√£o e Testemunho", 15, "#28a745", "#ffffff");
            adicionarFase("Estudo da Li√ß√£o", 35, "#007bff", "#ffffff");

            setInterval(() => {
                document.getElementById('relogio-real').innerText = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            }, 1000);
        };

        // Fun√ß√µes de salvamento (JSON) omitidas por brevidade mas seguem a mesma l√≥gica anterior
        function salvarConfiguracao() {
            const dados = {
                titulo: document.getElementById('global-titulo').value,
                fases: Array.from(document.querySelectorAll('.fase-wrapper')).map(w => ({
                    t: w.querySelector('.inp-titulo').value,
                    m: w.querySelector('.inp-tempo').value
                }))
            };
            const blob = new Blob([JSON.stringify(dados)], {type: 'application/json'});
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'cronos_config.json'; a.click();
        }
    </script>
</body>
</html>