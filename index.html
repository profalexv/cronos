<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Cronos v1.5</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>

    <div id="custom-tooltip"></div>
    <input type="file" id="file-input" style="display: none;" accept=".json" onchange="carregarArquivo(this)">
    <input type="file" id="folder-input" style="display: none;" webkitdirectory directory onchange="processarPastaTrabalho(this)">

    <div id="config-screen">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; border-bottom:1px solid #333; padding-bottom:15px;">
            <div style="display:flex; align-items:center; gap:10px; flex-grow:1; margin-right:20px;">
                <input type="text" id="global-titulo" value="Escola Sabatina Viva" data-tooltip="Clique para editar o tÃ­tulo do evento.">
                <input type="color" id="global-cor-titulo" value="#00d2ff" style="width:40px; height:35px; border:none;" data-tooltip="Alterar cor do tÃ­tulo.">
                <label class="chk-label"><input type="checkbox" id="chk-exibir-titulo" class="chk-input"> Exibir</label>
            </div>
            <div style="display:flex; gap:10px;">
                <button id="btn-midia" class="btn-file btn-folder" onclick="document.getElementById('folder-input').click()" data-tooltip="PASSO 1: Selecione a pasta onde estÃ£o seus arquivos de Ã¡udio/imagem.">ğŸ“‚ Pasta MÃ­dia</button>
                <a href="manual.html" target="_blank" class="btn-file" data-tooltip="Ver Manual de Uso">â“ Manual</a>
                <a href="sobre.html" target="_blank" class="btn-file" data-tooltip="Sobre o Sistema">â„¹ï¸ Sobre</a>
                <button class="btn-file" onclick="acaoSalvar()" data-tooltip="Salvar a programaÃ§Ã£o (JSON).">ğŸ’¾ Salvar</button>
                <button class="btn-file" onclick="acaoAbrir()" data-tooltip="Carregar arquivo JSON.">ğŸ“‚ Abrir</button>
            </div>
        </div>
        
        <div class="painel-top">
            <div class="campo" data-tooltip="InÃ­cio da programaÃ§Ã£o.">
                <label>InÃ­cio Planejado</label>
                <div class="time-group" id="group-inicio">
                    <input type="time" id="hora-inicio">
                    <button class="btn-small" onclick="calcSetInicioAgora()" data-tooltip="Definir para AGORA">â±ï¸</button>
                    <button class="btn-small" onclick="calcInicioPeloFim()" data-tooltip="Calcular InÃ­cio baseado no Fim">âª</button>
                </div>
                <label class="chk-label" style="margin-top:5px; font-size:0.8rem; color:#aaa;">
                    <input type="checkbox" id="chk-ignorar-inicio" class="chk-input" onchange="toggleIgnorarInicio()"> Ignorar InÃ­cio
                </label>
            </div>
            
            <div class="campo" data-tooltip="HorÃ¡rio limite.">
                <label>Fim Absoluto</label>
                <div class="time-group" id="group-fim">
                    <input type="time" id="hora-fim">
                    <button class="btn-small" onclick="calcFimPeloInicio()" data-tooltip="Calcular Fim baseado no InÃ­cio">â©</button>
                </div>
                <label class="chk-label" style="margin-top:5px; font-size:0.8rem; color:#aaa;">
                    <input type="checkbox" id="chk-ignorar-fim" class="chk-input" onchange="toggleIgnorarFim()"> Ignorar Fim (Livre)
                </label>
            </div>
            
            <div class="campo" style="flex-direction: row; align-items: center; gap: 20px; padding-bottom: 5px;">
                <label class="chk-label"><input type="checkbox" id="chk-intervalos" onchange="toggleIntervalosGlobais()" class="chk-input"> Intervalos</label>
                <label class="chk-label"><input type="checkbox" id="chk-estouro-global" onchange="toggleEstouroGlobal()" class="chk-input"> Permitir Estouro</label>
                <label class="chk-label"><input type="checkbox" id="chk-audio-global" onchange="toggleAudioGlobal()" class="chk-input"> Permitir Ãudio</label>
            </div>
        </div>

        <div id="lista-fases"></div>

        <div style="display:flex; gap:15px; margin-top:20px; padding-bottom:50px;">
            <button class="btn-add" onclick="adicionarFase()" data-tooltip="Adiciona nova linha.">+ Nova Etapa</button>
            <button class="btn-go" onclick="iniciarApresentacao()" data-tooltip="Inicia o cronÃ´metro e bloqueia a tela.">INICIAR APRESENTAÃ‡ÃƒO â–·</button>
        </div>
    </div>

    <div id="display-screen">
        <button id="btn-sair" onclick="encerrar()" title="Sair" data-tooltip="Sair e voltar Ã  configuraÃ§Ã£o">âœ•</button>
        <div class="overlay"></div>
        <div id="relogio-real" data-tooltip="Hora Atual">--:--</div>

        <div class="conteudo-box" id="box-principal">
            <h1 id="display-global-titulo" class="hidden"></h1>
            <h2 id="titulo-fase">...</h2>
            <div id="lbl-fim">FIM</div>
            <div id="area-timer" data-tooltip="Tempo restante"><div id="timer-principal">00:00</div></div>
            <button id="btn-intervalo-manual" class="btn-proximo hidden" onclick="sairIntervaloManual()" data-tooltip="Iniciar prÃ³xima parte">INICIAR PRÃ“XIMA PARTE â–¶</button>
            
            <div id="info-horarios">
                <span data-tooltip="HorÃ¡rio limite configurado (Fim Absoluto)">ğŸ Limite: <strong id="lbl-fim-absoluto" style="color:#e0e0e0">--:--</strong></span>
                <span data-tooltip="PrevisÃ£o de tÃ©rmino baseada no tempo restante">ğŸ”® PrevisÃ£o: <strong id="lbl-fim-previsto" style="color:#28a745">--:--</strong></span>
            </div>

            <div id="rodape-info"><span id="txt-status" style="color:#00d2ff;">Tempo Normal</span><span id="txt-proximo">PrÃ³ximo: ...</span></div>
            <div class="controles-play">
                <button id="btn-pausar" class="btn-ctrl" onclick="acaoPausar()" data-tooltip="Pausar ou Parar o tempo">â¸ PAUSAR</button>
                <button id="btn-continuar" class="btn-ctrl hidden" onclick="acaoContinuar()" data-tooltip="Continuar contagem">â–¶ Continuar</button>
                <button class="btn-ctrl" onclick="acaoAdicionarTempo()" style="border-color:#00d2ff; color:#00d2ff;" data-tooltip="Adiciona 1 minuto extra.">+1 Min</button>
                <button class="btn-ctrl" onclick="acaoReiniciarFase()" style="border-color:#ffaa00; color:#ffaa00;" data-tooltip="Reiniciar etapa atual">â†º Reiniciar</button>
                <button id="btn-avancar" class="btn-ctrl" onclick="acaoAvanÃ§ar()" style="border-color:#00d2ff; color:#00d2ff;" data-tooltip="Pular etapa.">â­ AvanÃ§ar</button>
                <button class="btn-ctrl" onclick="encerrar()" style="border-color:#ff4444; color:#ff4444;" data-tooltip="Sair.">â¹ Encerrar</button>
            </div>
        </div>
    </div>

    <div id="modal-severe-delay" class="modal-base">
        <div class="modal-box" style="border-color:#ff4444;">
            <h2 style="color:#ff4444; margin-top:0;">ğŸ›‘ Atraso CrÃ­tico</h2>
            <p>O atraso Ã© maior que a 1Âª fase inteira ou 25% do total.</p>
            <div class="modal-opts">
                <button class="btn-modal" style="background:var(--warning); color:black;" onclick="handleSevereAction('ignore')"><b>ğŸ”“ Ignorar Tempo Final</b> <span>(Prosseguir)</span></button>
                <button class="btn-modal" style="background:#444;" onclick="handleSevereAction('cancel')"><b>âœï¸ AJUSTAR</b> <span>(Voltar)</span></button>
            </div>
        </div>
    </div>

    <div id="modal-moderate-delay" class="modal-base">
        <div class="modal-box" style="border-color:var(--warning);">
            <h2 style="color:var(--warning); margin-top:0;">âš ï¸ Atraso ConsiderÃ¡vel</h2>
            <p>O tempo Ã© insuficiente. Escolha uma soluÃ§Ã£o:</p>
            <div class="modal-opts" style="max-height:400px; overflow-y:auto;">
                <button class="btn-modal" onclick="handleModerateAction(1)"><b>1. Descontar da 1Âª Fase</b> <span id="lbl-mod-1"></span></button>
                <button class="btn-modal" onclick="handleModerateAction(2)"><b>2. Eliminar 1Âª Fase e Distribuir</b> <span>(Para todas)</span></button>
                <button class="btn-modal" onclick="handleModerateAction(3)"><b>3. Eliminar 1Âª Fase e Flexibilizar</b> <span>(SÃ³ Flex)</span></button>
                <button class="btn-modal" onclick="handleModerateAction(4)"><b>4. Descontar da Ãšltima Fase</b> <span id="lbl-mod-4"></span></button>
                <button class="btn-modal" style="background:#444;" onclick="handleModerateAction(5)"><b>5. Reajustar Manualmente</b> <span>(Voltar)</span></button>
                <button class="btn-modal" style="background:var(--accent); color:black;" onclick="handleModerateAction(6)"><b>6. Ajustar Limite</b> <span>(Empurrar Fim)</span></button>
                <button class="btn-modal" style="background:var(--danger);" onclick="handleModerateAction(7)"><b>7. Ignorar Limites</b> <span>(Modo Livre)</span></button>
            </div>
        </div>
    </div>

    <div id="modal-runtime-adjust" class="modal-base">
        <div class="modal-box" style="border-color:#ff4444;">
            <h2 style="color:#ff4444; margin-top:0;">âš ï¸ Tempo Esgotado</h2>
            <p>O tempo limite foi atingido.</p>
            <div class="modal-opts">
                <button class="btn-modal" style="background:#007bff;" onclick="handleRuntimeAction('auto')"><b>ğŸ“‰ Ajustar Tempo</b> <span>(Comprimir FlexÃ­veis)</span></button>
                <button class="btn-modal" style="background:var(--warning); color:black;" onclick="handleRuntimeAction('ignore')"><b>ğŸ”“ Ignorar Limites</b> <span>(Prosseguir)</span></button>
                <button class="btn-modal" style="background:#444;" onclick="handleRuntimeAction('reprogram')"><b>ğŸ“ Reprogramar</b> <span>(Manual)</span></button>
            </div>
        </div>
    </div>

    <div id="modal-reprogram-manual" class="modal-base" style="z-index: 120;">
        <div class="modal-box" style="border-color:var(--accent);">
            <h2 style="color:var(--accent); margin-top:0;">ğŸ“ ReprogramaÃ§Ã£o Manual</h2>
            <div id="reprogram-list"></div>
            <div class="reprogram-row" style="border-top:1px solid #555; padding-top:10px; margin-top:10px;">
                <label>Novo HorÃ¡rio Limite:</label>
                <input type="time" id="new-end-time-input">
            </div>
            <div class="modal-opts" style="flex-direction:row;">
                <button class="btn-modal" style="flex:1; background:var(--success);" onclick="applyReprogramming()"><b>Salvar</b></button>
                <button class="btn-modal" style="flex:1; background:#444; justify-content:center;" onclick="document.getElementById('modal-reprogram-manual').style.display='none'">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="modal-surplus-check" class="modal-base">
        <div class="modal-box" style="border-color:#00d2ff;">
            <h2 style="color:#00d2ff; margin-top:0;">â³ Tempo de Sobra Detectado</h2>
            <p>HÃ¡ uma folga de <b><span id="surplus-display-val"></span> minutos</b> atÃ© o limite final.</p>
            <div class="modal-opts">
                <button class="btn-modal" style="background:#444;" onclick="handleSurplusDecision('wait')"><b>â³ INSERIR AGUARDE</b> (Queimar Tempo)</button>
                <button class="btn-modal" style="background:#28a745; color:white;" onclick="handleSurplusDecision('distribute')"><b>ğŸ DISTRIBUIR NAS FASES</b></button>
                <button class="btn-modal" style="background:#007bff; color:white;" onclick="handleSurplusDecision('start')"><b>â–¶ INICIAR DIRETO</b> (Terminar Cedo)</button>
            </div>
        </div>
    </div>

    <div id="modal-surplus-dist" class="modal-base">
        <div class="modal-box" style="border-color:#28a745;">
            <h2 style="color:#28a745; margin-top:0;">ğŸ Distribuir Tempo Extra</h2>
            <div class="modal-opts">
                <button class="btn-modal dist-option" onclick="handleSurplusDistribution('all')"><b>1. Distribuir Geral</b> <span>(Todas Prop.)</span></button>
                <button class="btn-modal dist-option" onclick="handleSurplusDistribution('first')"><b>2. + 1Âª Fase</b> <span id="lbl-first-phase" style="font-size:0.8em; color:#aaa;">(...)</span></button>
                <button class="btn-modal dist-option" onclick="handleSurplusDistribution('last')"><b>3. + Ãšltima Fase</b> <span>(Fim)</span></button>
                <button class="btn-modal dist-option" onclick="handleSurplusDistribution('flex')"><b>4. + FlexÃ­veis</b> <span>(Apenas FlexÃ­veis)</span></button>
            </div>
        </div>
    </div>

    <div id="modal-early-start" class="modal-base">
        <div class="modal-box" style="border-color:#00d2ff;">
            <h2 style="color:#00d2ff; margin-top:0;">â³ InÃ­cio Antecipado</h2>
            <p>VocÃª estÃ¡ adiantado em relaÃ§Ã£o ao horÃ¡rio de inÃ­cio!</p>
            <div class="modal-opts">
                <button class="btn-modal" style="background:#444;" onclick="handleEarlyStart('wait')"><b>âœ‹ AGUARDAR</b> (Modo Espera)</button>
                <button class="btn-modal" style="background:#28a745; color:white;" onclick="handleEarlyStart('start')"><b>â–¶ INICIAR</b></button>
            </div>
        </div>
    </div>

    <div id="modal-audio-pause" class="modal-base" style="z-index: 110;">
        <div class="audio-pause-box">
            <h2 style="color:#00d2ff; margin-top:0;">ğŸµ Ãudio em ExecuÃ§Ã£o</h2>
            <p>O tempo parou, mas hÃ¡ um Ã¡udio tocando. O que fazer?</p>
            <div class="audio-pause-opts">
                <button class="btn-aud-opt" style="background:#28a745;" onclick="resolverAudioPause('continue')">ğŸ”Š PROSSEGUIR ÃUDIO (Deixar tocando)</button>
                <button class="btn-aud-opt" style="background:#ffaa00; color:#000;" onclick="resolverAudioPause('pause')">â¸ï¸ PAUSAR ÃUDIO (Retoma ao voltar)</button>
                <button class="btn-aud-opt" style="background:#007bff;" onclick="resolverAudioPause('restart')">â®ï¸ REINICIAR ÃUDIO (Do comeÃ§o)</button>
                <button class="btn-aud-opt" style="background:#ff4444;" onclick="resolverAudioPause('stop')">â¹ï¸ PARAR ÃUDIO (Encerrar)</button>
            </div>
        </div>
    </div>

    <div id="modal-missing-media" class="modal-base">
        <div class="modal-box" style="border-color: var(--warning);">
            <h2 style="color: var(--warning); margin-top:0;">ğŸ“‚ Pasta de MÃ­dia NecessÃ¡ria</h2>
            <p>Este arquivo contÃ©m referÃªncias a imagens ou Ã¡udios.</p>
            <div class="modal-opts">
                <button class="btn-modal" style="background: var(--success); color:white;" onclick="resolveMissingMedia()"><b>ğŸ“ Selecionar Pasta</b></button>
                <button class="btn-modal" style="background: #444;" onclick="document.getElementById('modal-missing-media').style.display='none'">Ignorar</button>
            </div>
        </div>
    </div>

    <script src="scripts/globals.js"></script>
    <script src="scripts/audio.js"></script>
    <script src="scripts/ui.js"></script>
    <script src="scripts/main.js"></script>
</body>
</html>
